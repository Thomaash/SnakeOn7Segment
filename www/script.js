define("init/create",[],function(){return function(){game.scale.scaleMode=Phaser.ScaleManager.SHOW_ALL,game.scale.pageAlignVertically=!0,game.stage.backgroundColor="#000",game.input.addPointer(),game.input.addPointer(),game.input.addPointer(),game.input.addPointer(),game.state.start("MenuMain")}}),define("init/main",["init/create"],function(e){return{create:e}}),define("tools/changeSize",[],function(){return function(e,t,n){t=typeof t=="number"?t:1200,n=typeof n=="number"?n:720,e.width=t,e.height=n,e.stage.getBounds.width=t,e.stage.getBounds.height=n,e.world.setBounds(0,0,t,n),e.camera.setSize(t,n),e.camera.setBoundsToWorld(),e.renderer.resize(t,n)}}),define("menuMain/preload",["tools/changeSize"],function(e){return function(){e(game),game.load.spritesheet("button","assets/buttons.png",320,64),game.load.spritesheet("buttonSquare","assets/buttonSquare.png",64,64),game.load.image("header","assets/header.png")}}),define("ui/button",[],function(){return function(e,t,n,r,i){var s=game.add.group(),o;s.position.x=e,s.position.y=t,r==null?o={overFrame:0,outFrame:0,downFrame:0,upFrame:0}:o={overFrame:1,outFrame:0,downFrame:1,upFrame:0};var u=new Phaser.Button(game,0,0,i,r,this,o.overFrame,o.outFrame,o.downFrame,o.upFrame),a=new Phaser.Text(game,0,0,n,this.style);return u.anchor.setTo(.5,.5),a.anchor.setTo(.5,.5),s.add(u),s.add(a),{group:s,button:u,label:a}}}),define("ui/helpButton",["ui/button"],function(e){return function(t,n,r){if(!game.vars.help)return;return e(t,n,"?",function(){game.state.start("Help",undefined,undefined,r,game.state.current)},"buttonSquare")}}),define("menuMain/create",["ui/button","ui/helpButton"],function(e,t){var n={classic:function(){game.vars.gameType="classic",game.vars.walledMap=!0,game.vars.holesInMap=!1,game.vars.enemy=0,game.vars.multiplayer=!1,game.state.start("Countdown")},single:function(){game.state.start("MenuPlay")},scores:function(){game.state.start("HighScores")},settings:function(){game.state.start("MenuSettings")}};return function(){var r=game.add.sprite(game.world.centerX,0,"header"),i=game.world.centerX,s=game.world.centerY;r.anchor.setTo(.5,0),s+=80,e(i,s,"Play Classic",n.classic,"button"),e(i+200,s,game.vars.level.floor(),n.classic,"buttonSquare"),t(i-200,s,"classic"),s+=80,e(i,s,"Play single level",n.single,"button"),t(i-200,s,"single"),s+=80,e(i,s,"High scores",n.scores,"button"),s+=80,e(i,s,"Settings",n.settings,"button")}}),define("menuMain/main",["menuMain/preload","menuMain/create"],function(e,t){return{preload:e,create:t}}),define("menuPlay/preload",["tools/changeSize"],function(e){return function(){e(game),game.load.spritesheet("button","assets/buttons.png",320,64),game.load.spritesheet("buttonSquare","assets/buttonSquare.png",64,64)}}),define("menuPlay/create",["ui/button","ui/helpButton"],function(e,t){var n,r,i,s,o,u,a={menu:function(){game.state.start("MenuMain")},single:function(){game.vars.gameType="single",game.state.start("Countdown")},rowSub:function(){game.vars.rows>2&&n.setText(--game.vars.rows)},rowAdd:function(){n.setText(++game.vars.rows)},enemySub:function(){game.vars.enemy>0&&r.setText(--game.vars.enemy)},enemyAdd:function(){r.setText(++game.vars.enemy)},speedSub:function(){game.vars.speed>1&&i.setText(--game.vars.speed)},speedAdd:function(){game.vars.speed<120&&i.setText(++game.vars.speed)},walledMap:function(){game.vars.walledMap=!game.vars.walledMap,a.walledSetColor()},holesInMap:function(){game.vars.holesInMap=!game.vars.holesInMap,a.holesSetColor()},multiplayer:function(){game.vars.multiplayer=!game.vars.multiplayer,a.multiplayerSetColor()},walledSetColor:function(){a.setColor(game.vars.walledMap,s)},holesSetColor:function(){a.setColor(game.vars.holesInMap,o)},multiplayerSetColor:function(){a.setColor(game.vars.multiplayer,u)},setColor:function(e,t){e?(t.button.setFrames(0,0,0,0),t.label.setText("✔")):(t.button.setFrames(2,2,2,2),t.label.setText("✘"))}};return function(){var f,l,c=324;e(200,40,"Menu",a.menu,"button"),e(game.world.width-200,40,"Play!",a.single,"button"),l=240,f=game.world.centerX-c,e(f,l,"Rows",null,"button"),e(f-72,l+80,"−",a.rowSub,"buttonSquare"),n=e(f,l+80,game.vars.rows,null,"buttonSquare").label,e(f+72,l+80,"+",a.rowAdd,"buttonSquare"),t(f,l-80,"rows"),f=game.world.centerX,e(f,l,"Enemies",null,"button"),e(f-72,l+80,"−",a.enemySub,"buttonSquare"),r=e(f,l+80,game.vars.enemy,null,"buttonSquare").label,e(f+72,l+80,"+",a.enemyAdd,"buttonSquare"),t(f,l-80,"enemies"),f=game.world.centerX+c,e(f,l,"Speed",null,"button"),e(f-72,l+80,"−",a.speedSub,"buttonSquare"),i=e(f,l+80,game.vars.speed,null,"buttonSquare").label,e(f+72,l+80,"+",a.speedAdd,"buttonSquare"),t(f,l-80,"speed"),l+=250,f=game.world.centerX-c,e(f,l,"Walled map",a.walledMap,"button"),t(f-128-64-4,l,"walledMap"),s=e(f+128+64+4,l,"",a.walledMap,"buttonSquare"),a.walledSetColor(),f=game.world.centerX+c,e(f,l,"Holes in map",a.holesInMap,"button"),t(f+128+64+4,l,"holesInMap"),o=e(f-128-64-4,l,"",a.holesInMap,"buttonSquare"),a.holesSetColor(),l+=80,f=game.world.centerX+c,e(f,l,"Multiplayer",a.multiplayer,"button"),t(f+128+64+4,l,"multiplayer"),u=e(f-128-64-4,l,"",a.multiplayer,"buttonSquare"),a.multiplayerSetColor()}}),define("tools/storage",[],function(){return{save:function(e,t){localStorage.setItem("So7S_"+e,game.vars[t])},load:function(e,t){var n=localStorage.getItem("So7S_"+e),r=this.defaults[e];if(n==null)game.vars[t]=r;else switch(typeof r){case"boolean":game.vars[t]=n==="true";break;case"number":game.vars[t]=n,isNaN(game.vars[t])&&(game.vars[t]=r);break;default:game.vars[t]=n}},defaults:{rows:2,speed:6,walled:!0,holes:!1,enemy:0,multiplayer:!1,help:!0}}}),define("menuPlay/storage",["tools/storage"],function(e){return{save:function(){e.save("rows","rows"),e.save("speed","speed"),e.save("walled","walledMap"),e.save("holes","holesInMap"),e.save("enemy","enemy"),e.save("multiplayer","multiplayer")},load:function(){e.load("rows","rows"),e.load("speed","speed"),e.load("walled","walledMap"),e.load("holes","holesInMap"),e.load("enemy","enemy"),e.load("multiplayer","multiplayer")}}}),define("menuPlay/main",["menuPlay/preload","menuPlay/create","menuPlay/storage"],function(e,t,n){return{init:function(){n.load()},preload:e,create:t,shutdown:function(){n.save()}}}),define("highScores/preload",["tools/changeSize"],function(e){return function(){e(game),game.load.spritesheet("button","assets/buttons.png",320,64)}}),define("tools/score",[],function(){return{save:function(e,t){var n=this.load(),r;switch(e){case"classic":n=n.classic,r="So7S_Scores";break;case"single":n=n.single,r="So7S_ScoresSingle"}if(n!=null){for(var i=0;i<n.length;i++)if(n[i]<t){var s=t;t=n[i],n[i]=s}n.length<8&&(n[n.length]=t)}else n=[t];localStorage.setItem(r,JSON.stringify(n))},load:function(){return{classic:JSON.parse(localStorage.getItem("So7S_Scores")),single:JSON.parse(localStorage.getItem("So7S_ScoresSingle"))}},reset:function(){localStorage.removeItem("So7S_Scores"),localStorage.removeItem("So7S_ScoresSingle")}}}),define("tools/ordinal",[],function(){return function(e){return e=String(e),/1\d$/.exec(e)?e+"th":/1$/.exec(e)?e+"st":/2$/.exec(e)?e+"nd":/3$/.exec(e)?e+"rd":e+"th"}}),define("highScores/create",["ui/button","tools/score","tools/ordinal"],function(e,t,n){function i(t,r,i,s){e(i,s,t,null,"button"),s+=80;if(r!=null)for(var o=0;o<r.length&&o<9;o++)e(i,s,n(o+1)+": "+r[o]+" points",null,"button"),s+=80;else e(i,s,"No scores yet",null,"button")}var r={menu:function(){game.state.start("MenuMain")},reset:function(){t.reset(),game.state.start("HighScores")}};return function(){var n=t.load();e(200,72,"Menu",r.menu,"button"),e(200,game.world.height-72,"Reset",r.reset,"button"),i("Classic",n.classic,game.world.centerX,40),i("Single",n.single,game.world.centerX+360,40)}}),define("highScores/main",["highScores/preload","highScores/create"],function(e,t){return{preload:e,create:t}}),define("menuSettings/create",["ui/button"],function(e){var t,n={menu:function(){game.state.start("MenuMain")},help:function(){game.vars.help=!game.vars.help,n.helpSetColor()},helpSetColor:function(){n.setColor(game.vars.help,t)},setColor:function(e,t){e?(t.button.setFrames(0,0,0,0),t.label.setText("✔")):(t.button.setFrames(2,2,2,2),t.label.setText("✘"))}};return function(){var r,i,s=324;e(200,40,"Menu",n.menu,"button"),i=240,r=game.world.centerX-s,e(r,i,"Show help",n.help,"button"),t=e(r+196,i,"",n.help,"buttonSquare"),n.helpSetColor()}}),define("menuSettings/storage",["tools/storage"],function(e){return{save:function(){e.save("help","help")},load:function(){e.load("help","help")}}}),define("menuSettings/main",["menuPlay/preload","menuSettings/create","menuSettings/storage"],function(e,t,n){return{init:function(){n.load()},preload:e,create:t,shutdown:function(){n.save()}}}),define("help/init",[],function(){var e={classic:"In Classic you will proceed to higher levels by eating food (making your snake longer).\nBut you can also fall to lower level if you failed to make your snake long enough.\n\n- Higher levels have bigger maps and faster snakes.\n- Number right of Classic button in main menu indicates your current level.",single:"In Single level you can freely select map size, speed and many other parameters.\nYou can also play against computer controlled enemies and/or other player.",holesInMap:"This setting (if enabled) places holes (= obstacles) into map.\nHint: Hitting hole is lethal.",multiplayer:"2 snakes for 2 players.\nControls will be explained at countdown screen.",walledMap:"Sets (invisible) wall around map.\nIf turned off, you can hit left edge of map and your snake will appear at the right edge.\nIf turned on, your snake will die upon hitting a map edge.",rows:"Map size. Minimum is 2 and maximum is not limited.\n\nWARNING: Setting too high value will make game extremely slow and potentially unplayable.",enemies:"Computer controlled 1 LED long cyan enemies. Their amount is not limited.\nEnemies are aimlessly wandering around map and eating your food. Hitting them is lethal.\n\nWARNING 1: Setting too many will make game extremely slow and potentially unplayable.\nWARNING 2: Setting too many can fill up too much space on the map and make game unplayable.",speed:"Number of LEDs your snake will move in 2 seconds. Higher means faster, lower slower.\nAffects enemies and food too."};return function(t,n){this.game.state.states.Help.text=e[t]!=null?e[t]:"Help not found, sorry ☹.\nID: "+t,this.game.state.states.Help.back=n}}),define("help/create",["ui/button"],function(e){function t(e){var t=game.add.text(40,game.world.height/2,e,{font:game.vars.font.menu(),fill:game.vars.font.fill,align:"left"});return t.anchor.set(0,.5),t.wordWrap=!0,t.wordWrapWidth=game.world.width-t.getBounds().x*2,t}function n(e){var t=game.add.text(game.world.width,game.world.height,e,{font:game.vars.font.footer(),fill:game.vars.font.fill,align:"right"});return t.anchor.set(1,1),t}var r={menu:function(){game.state.start(this.game.state.states.Help.back)}};return function(){e(200,40,"Close",r.menu,"button"),t(this.game.state.states.Help.text),n("Hint: Help buttons (question mark rhombuses) can be hidden in settings.")}}),define("help/main",["help/init","menuPlay/preload","help/create"],function(e,t,n){return{init:e,preload:t,create:n}}),define("countdown/preload",["tools/changeSize"],function(e){return function(){e(game),game.vars.quality=160,game.load.atlas("LEDs","assets/"+game.vars.quality+".png","assets/"+game.vars.quality+".json",Phaser.Loader.TEXTURE_ATLAS_JSON_HASH),game.load.spritesheet("Arrows","assets/Arrows.png",90,90)}}),define("segment/LED",[],function(){function e(e,t,n,r,i){this.id=r,this.TL={point:null,pos:null},this.BR={point:null,pos:null},this.pos=this.position[r],this.sprite=e.create(t+this.pos.x,n+this.pos.y,"LEDs"),this.sprite.x*=i||1,this.sprite.y*=i||1,this.setState(this.states.empty)}return e.prototype={states:{black:"black",empty:"black",red:"red",dead:"red",yellow:"yellow",food:"yellow",green:"green",snake0Head:"green",darkGreen:"darkGreen",snake0Body:"darkGreen",greenYellow:"greenYellow",snake1Head:"greenYellow",darkGreenYellow:"darkGreenYellow",snake1Body:"darkGreenYellow",cyan:"cyan",enemy:"cyan"},position:[{x:17,y:0,type:"h"},{x:160,y:17,type:"v"},{x:160,y:177,type:"v"},{x:17,y:320,type:"h"},{x:0,y:177,type:"v"},{x:0,y:17,type:"v"},{x:17,y:160,type:"h"}],setState:function(e){this.state=e,this.sprite.frameName=this.pos.type+e},getState:function(){return this.state}},e}),define("segment/Seven",["segment/LED"],function(e){function t(t,n,r,i){this.leds=[];var s=n*(this.width+this.margin)+this.margin/2,o=r*(this.height+this.margin)+this.margin/2;for(var u=0;u<e.prototype.position.length;++u)this.leds[u]=new e(t,s,o,u,i)}return t.prototype={margin:8,width:192,height:352,state:{led:e.prototype.states,segment:{off:[0,0,0,0,0,0,0],0:[1,1,1,1,1,1,0],1:[0,1,1,0,0,0,0],2:[1,1,0,1,1,0,1],3:[1,1,1,1,0,0,1],4:[0,1,1,0,0,1,1],5:[1,0,1,1,0,1,1],6:[1,0,1,1,1,1,1],7:[1,1,1,0,0,0,0],8:[1,1,1,1,1,1,1],9:[1,1,1,1,0,1,1]}},setState:function(e,t){t==null&&(t="red");if(typeof e=="number"||typeof e=="string")e=this.state.segment[e];for(var n=0;n<this.leds.length;++n)this.leds[n].setState(e[n]?t:"black")},getRandomLED:function(){return this.leds[Math.floor(7*Math.random())]}},t}),define("ui/text",[],function(){return function(e,t,n,r,i,s){var o=new Phaser.Text(game,n==null?game.world.centerX:n,r==null?game.world.height/3:r,e,{font:game.vars.font.menu(),fill:game.vars.font.fill,align:"center"});return o.anchor.set(.5,.5),o.angle=i==null?0:i,o.wordWrap=!0,o.wordWrapWidth=s==null?game.world.width-50:s,t.add(o),o}}),define("countdown/create",["ui/button","segment/Seven","ui/text"],function(e,t,n){function r(){game.state.start(game.vars.gameType==="classic"?"MenuMain":"MenuPlay")}function i(e,t,n,r,i,s){var o=e.create(t,n,i,0);o.anchor.setTo(.5,.5),o.angle=r,s!=null&&(o.frameName=s)}return function(){game.vars.countDown=3,game.vars.update=60;var s=game.add.group(),o=game.add.group(),u=game.add.group();e(200,40,"Menu",r,"button");var a="Tap left half of the screen to turn left, right to turn right.";game.vars.multiplayer?(i(u,game.world.width*.25,game.world.height*.2,90,"Arrows"),i(u,game.world.width*.25,game.world.height*.8,270,"Arrows"),i(u,game.world.width*.75,game.world.height*.2,90,"Arrows"),i(u,game.world.width*.75,game.world.height*.8,270,"Arrows"),i(u,game.world.width*.75,game.world.height*.5,0,"LEDs","vgreenYellow"),i(u,game.world.width*.25,game.world.height*.5,0,"LEDs","vgreen"),n(a,u,game.world.width*.7,game.world.height*.5,-90,game.world.height),n(a,u,game.world.width*.3,game.world.height*.5,90,game.world.height)):(i(u,game.world.width*.2,game.world.height*.5,0,"Arrows"),i(u,game.world.width*.8,game.world.height*.5,180,"Arrows"),i(u,game.world.width*.5,game.world.height*.2,0,"LEDs","hgreen"),n(a,u));var f=game.add.graphics(0,0);f.lineStyle(4,4473924),f.moveTo(game.world.width/2,0),f.lineTo(game.world.width/2,game.world.height),game.vars.multiplayer&&(f.moveTo(0,game.world.height/2),f.lineTo(game.world.width,game.world.height/2)),o.add(f),game.vars.segments=new t(s,3,1)}}),define("countdown/update",["segment/Seven"],function(e){return function(){if(++game.vars.update>=60){var t,n=game.vars.segments;if(game.vars.countDown>0){game.vars.update=0;switch(game.vars.countDown){case 1:t=e.prototype.state.led.green;break;case 2:t=e.prototype.state.led.yellow;break;case 3:t=e.prototype.state.led.red;break;default:t=e.prototype.state.led.darkGreen}n.setState(e.prototype.state.segment[game.vars.countDown--],t)}else n.setState(e.prototype.state.segment.off),game.state.start("Game")}}}),define("countdown/shutdown",[],function(){return function(){game.vars.segments=null}}),define("countdown/main",["countdown/preload","countdown/create","countdown/update","countdown/shutdown"],function(e,t,n,r){return{preload:e,create:t,update:n,shutdown:r}}),define("game/preload",["segment/Seven"],function(e){function t(t,n){var r=Math.min(window.innerWidth/t/e.prototype.width,window.innerHeight/n/e.prototype.height),i={high:.875,medium:.625,low:.375};return r>i.high?160:r>i.medium?120:r>i.low?80:40}return function(){switch(game.vars.gameType){case"classic":game.vars.rows=game.vars.level.floor()+1,game.vars.cols=3*game.vars.rows,game.vars.speed=game.vars.level.floor()*3;break;case"single":game.vars.cols=3*game.vars.rows}game.vars.quality=t(game.vars.cols,game.vars.rows),game.load.atlas("LEDs","assets/"+game.vars.quality+".png","assets/"+game.vars.quality+".json",Phaser.Loader.TEXTURE_ATLAS_JSON_HASH)}}),define("tools/Point",[],function(){function e(e,t,n,r,i,s,o,u){this.tl=e,this.tr=t,this.rt=n,this.rb=r,this.br=i,this.bl=s,this.lb=o,this.lt=u,this.clearBlocking(),this.lt!=null&&(this.lt.BR.point=this,this.lt.BR.pos="lt"),this.tl!=null&&(this.tl.BR.point=this,this.tl.BR.pos="tl"),this.tr!=null&&(this.tr.BR.point=this,this.tr.BR.pos="tr"),this.lb!=null&&(this.lb.BR.point=this,this.lb.BR.pos="lb"),this.rt!=null&&(this.rt.TL.point=this,this.rt.TL.pos="rt"),this.rb!=null&&(this.rb.TL.point=this,this.rb.TL.pos="rb"),this.br!=null&&(this.br.TL.point=this,this.br.TL.pos="br"),this.bl!=null&&(this.bl.TL.point=this,this.bl.TL.pos="bl")}return e.prototype={block:function(e,t){this.blocked[this.getCrossing(e,t)]={from:this[e],to:this[t]}},unblock:function(e){this.blocked.hb!=null&&this.blocked.hb.from===e?this.blocked.hb=null:this.blocked.ht!=null&&this.blocked.ht.from===e?this.blocked.ht=null:this.blocked.vl!=null&&this.blocked.vl.from===e?this.blocked.vl=null:this.blocked.vr!=null&&this.blocked.vr.from===e&&(this.blocked.vr=null)},isBlocked:function(e,t){var n=[];switch(this.getCrossing(e,t)){case"ht":n=["vl","vr","ht"];break;case"hb":n=["vl","vr","hb"];break;case"vl":n=["hb","ht","vl"];break;case"vr":n=["hb","ht","vr"]}for(var r=0;r<n.length;++r)if(this.blocked[n[r]]!=null)return!0},clearBlocking:function(){this.blocked={ht:null,hb:null,vl:null,vr:null}},getCrossing:function(e,t){if(e.localeCompare(t)>0){var n=e;e=t,t=n}switch(e+t){case"ltrt":case"rttl":case"lttr":return"ht";case"lbrb":case"blrb":case"brlb":return"hb";case"bltl":case"lbtl":case"bllt":return"vl";case"brtr":case"rbtr":case"brrt":return"vr";default:return null}}},e}),define("tools/Map",["tools/Point"],function(e){function t(e,t){this.map=[],this.segments=e;var n=e.length,r=e[0].length*2,i;t?i=this.walledMap.bind(this):i=this.goThroughMap.bind(this);for(var s=0;s<=n;++s){this.map[s]=[];for(var o=0;o<=r;o++)i(s,o,n,r)}}return t.prototype.walledMap=function(e,t){var n=Math.floor(t/2),r=e-1,i=n-1;this.connect(e,t,e,n,r,i)},t.prototype.goThroughMap=function(e,t,n,r){var i=Math.floor(t/2),s=e===n?0:e,o=e-1<0?n:e-1,u=t===r?0:i,a=i-1<0?Math.floor(r/2):i-1;this.connect(e,t,s,u,o,a)},t.prototype.connect=function(e,t,n,r,i,s){t%2===0?this.map[e][t]=this.connectSegmentsTop(this.getSegment(i,s),this.getSegment(n,s),this.getSegment(n,r),this.getSegment(i,r)):this.map[e][t]=this.connectSegmentsMiddle(this.getSegment(i,r),this.getSegment(n,r))},t.prototype.connectSegmentsTop=function(t,n,r,i){var s,o,u,a,f,l,c,h;return t!=null&&(s=t.leds[2],h=t.leds[3]),n!=null&&(o=n.leds[4],u=n.leds[3]),r!=null&&(f=r.leds[5],a=r.leds[0]),i!=null&&(l=i.leds[1],c=i.leds[0]),new e(s,o,u,a,f,l,c,h)},t.prototype.connectSegmentsMiddle=function(t,n){var r,i,s,o,u,a,f,l;return t!=null&&(r=t.leds[1],l=t.leds[6],f=t.leds[6],a=t.leds[2]),n!=null&&(i=n.leds[5],s=n.leds[6],o=n.leds[6],u=n.leds[4]),new e(r,i,s,o,u,a,f,l)},t.prototype.getSegment=function(e,t){return this.segments[e]&&this.segments[e][t]?this.segments[e][t]:null},t.prototype.getRandomSegment=function(){var e=null;while(e==null){var t=Math.floor(this.segments.length*Math.random()),n=Math.floor(this.segments[t].length*Math.random());e=this.segments[t][n]}return e},t.prototype.getRandomLED=function(){var e=this.getRandomSegment();return e.getRandomLED()},t.prototype.clearBlocking=function(){for(var e=0;e<this.map.length;++e)for(var t=0;t<this.map[e].length;++t)this.map[e][t].clearBlocking()},t}),define("game/Snake",[],function(){function e(e,t,n,r,i,s){this.leds=[e],this.canEat=typeof n=="boolean"?n:!0,this.direction={previous:"r",next:"r"},this.ledsToChange={empty:null},this.deathCallback=t,this.states=e.states,this.colors={empty:e.states.empty},this.setDefaultColor("head",i),this.setDefaultColor("body",s),r&&(this.die=function(){}),e.setState(this.colors.head)}return e.prototype={die:function(){this.deathCallback!=null&&this.deathCallback(),this.index=this.leds.length,this.move=function(){var e=this.leds[--this.index];e!=null?e.setState(e.states.dead):this.move=function(){}},this.changeLeds=function(){},this.move()},length:function(){return this.leds.length},turn:function(e){this.direction.next=this.turns[e][this.direction.previous]},nextDir:function(e){this.turns.forbidden[this.direction.previous]!=e&&(this.direction.next=e)},move:function(){var e,t,n=this.leds[this.leds.length-1],r=!0;switch(this.direction.previous){case"t":case"l":e="TL";break;case"b":case"r":e="BR"}switch(this.direction.next){case"t":case"b":t=/[tb]/g;break;case"l":case"r":t=/[rl]/g}var i=n[e].pos,s=this.direction.next+n[e].pos.replace(t,""),o=n[e].point,u=o[s];this.direction.previous=this.direction.next;if(u==null||u.getState()!==u.states.empty&&u.getState()!==u.states.food||o.isBlocked(i,s)){this.die();return}u.getState()===u.states.food&&(game.vars.food=null,this.canEat&&(r=!1)),this.leds.push(u),u.setState(this.colors.head),o.block(i,s),n.setState(this.colors.body);if(r){var a=this.leds[0],f=this.leds[1];a.TL.point===f.TL.point||a.TL.point===f.BR.point?a.TL.point.unblock(a):(a.BR.point===f.TL.point||a.BR.point===f.BR.point)&&a.BR.point.unblock(a);for(var l=1;l<this.leds.length;++l)this.leds[l-1]=this.leds[l];this.leds.length--,this.ledsToChange.empty=a}},changeLeds:function(){this.changeLed(this.ledsToChange.empty,this.colors.empty)},changeLed:function(e,t){e!=null&&e.setState(t)},setDefaultColor:function(e,t){var n=e.charAt(0).toUpperCase()+e.slice(1);switch(typeof t){case"string":this.colors[e]=t;break;case"number":this.colors[e]=this.states["snake"+t+n];break;default:this.colors[e]=this.states["snake0"+n]}},turns:{left:{t:"l",r:"t",b:"r",l:"b"},right:{t:"r",r:"b",b:"l",l:"t"},forbidden:{t:"b",r:"l",b:"t",l:"r"}}},e}),define("game/Enemy",["game/Snake"],function(e){function t(t){var n=null;while(n==null||n.getState()!==n.states.empty)n=t.getRandomLED();this.snake=new e(n,null,!1,!0,n.states.enemy,n.states.enemy)}return t.prototype={choices:["left",null,null,null,null,"right"],rdg:new Phaser.RandomDataGenerator,move:function(){var e=this.rdg.pick(this.choices);e!=null&&this.snake.turn(e),this.snake.move(),this.snake.changeLeds()}},t}),define("game/create",["tools/Map","tools/changeSize","segment/Seven","game/Snake","game/Enemy"],function(e,t,n,r,i){function s(){game.vars.playersAlive--,game.vars.playersAlive==0&&(game.vars.clickAction="click")}return function(){game.vars.food=null,game.vars.playersAlive=1,game.vars.update=60;var o=game.add.group(),u=game.vars.quality/160,a=game.vars.cols*(n.prototype.width+n.prototype.margin)*u,f=game.vars.rows*(n.prototype.height+n.prototype.margin)*u;t(game,a,f);var l=[],c=game.vars.rows,h,p;for(h=0;h<game.vars.cols;++h){l[h]=[];for(p=0;p<game.vars.rows;++p)l[h][p]=!0}while(game.vars.holesInMap&&c>0)h=Math.floor(Math.random()*game.vars.cols),p=Math.floor(Math.random()*game.vars.rows),l[h][p]&&(p!==0||h!==0&&h!==1)&&(c--,l[h][p]=!1);game.vars.segments=[];for(h=0;h<game.vars.cols;++h){game.vars.segments[h]=[];for(p=0;p<game.vars.rows;++p)l[h][p]?game.vars.segments[h][p]=new n(o,h,p,u):game.vars.segments[h][p]=null}game.vars.LEDCount=game.vars.segments.length*game.vars.segments[0].length*7,game.vars.map=new e(game.vars.segments,game.vars.walledMap),game.vars.snakes=[new r(game.vars.map.map[0][0].rb,s,!0,!1,0,0)],game.vars.multiplayer&&(game.vars.snakes.push(new r(game.vars.map.map[0][2].rt,s,!0,!1,1,1)),game.vars.playersAlive++),game.vars.enemies=[];for(var d=0;d<game.vars.enemy;d++)game.vars.enemies[d]=new i(game.vars.map);game.vars.clickAction="turn"}}),define("game/update",["segment/Seven"],function(e){return function(){if(--game.vars.update<0){var t;game.vars.update=120/game.vars.speed;for(t=0;t<game.vars.snakes.length;t++)game.vars.snakes[t].move();for(t=0;t<game.vars.snakes.length;t++)game.vars.snakes[t].changeLeds();if(game.vars.food==null){var n=game.vars.map.getRandomLED();n.getState()===e.prototype.state.led.empty&&(n.setState(e.prototype.state.led.food),n.life=2*(game.vars.rows+game.vars.cols),game.vars.food=n)}else game.vars.food.life-=Math.random(),game.vars.food.life<0&&(game.vars.food.setState(e.prototype.state.led.empty),game.vars.food=null);for(t=0;t<game.vars.enemies.length;t++)game.vars.enemies[t].move()}}}),define("game/shutdown",[],function(){return function(){var e=game.vars.gameType==="single"?game.vars.speed/(game.vars.LEDCount/100):1;game.vars.scores=[];for(var t=0;t<game.vars.snakes.length;t++)game.vars.scores[t]=Math.round(game.vars.snakes[t].length()*e);game.vars.enemies=null,game.vars.food=null,game.vars.map=null,game.vars.segments=null,game.vars.snakes=null,game.vars.clickAction="click"}}),define("game/main",["game/preload","game/create","game/update","game/shutdown"],function(e,t,n,r){return{preload:e,create:t,shutdown:r,update:n}}),define("score/preload",["tools/changeSize"],function(e){return function(){e(game),game.vars.quality=game.vars.multiplayer?80:160,game.load.atlas("LEDs","assets/"+game.vars.quality+".png","assets/"+game.vars.quality+".json",Phaser.Loader.TEXTURE_ATLAS_JSON_HASH)}}),define("score/create",["ui/button","ui/text","tools/score","segment/Seven"],function(e,t,n,r){function s(e,t,n){var i=game.add.group(),s=game.vars.quality===160?6:5;e=((new Array(s+1)).join(" ")+e).slice(-s);for(var o=0;o<s;o++){var u=new r(i,o,0,game.vars.quality/160);u.setState(e[o]===" "?"off":e[o],t)}i.x=(game.world.width-i.width)*n,i.y=game.world.height-i.height}var i={menu:function(){game.state.start(game.vars.gameType==="classic"?"MenuMain":"MenuPlay")},play:function(){game.state.start("Countdown")}};return function(){e(200,40,"Menu",i.menu,"button"),e(game.world.width-200,40,"Play!",i.play,"button");switch(game.vars.gameType){case"classic":var o,u,a,f=game.vars.scores[0];f>=game.vars.LEDCount/2?(u=r.prototype.state.led.green,o=10,a="Awesome"):f>=game.vars.LEDCount/3?(u=r.prototype.state.led.darkGreen,o=5,a="Good job, but to proceed faster, get even higher score."):f>=game.vars.LEDCount/4?(u=r.prototype.state.led.yellow,o=1,a="Not bad, but to proceed faster, get higher score."):(u=r.prototype.state.led.red,o=-10,a="You won't proceed to next level this way, get higher score."),game.vars.level.add(0,o),s(f,u,1),n.save(game.vars.gameType,f),t(a,game.add.group());break;case"single":s(game.vars.scores[0],r.prototype.state.led.green,1),n.save(game.vars.gameType,game.vars.scores[0]),game.vars.multiplayer&&(s(game.vars.scores[1],r.prototype.state.led.greenYellow,0),n.save(game.vars.gameType,game.vars.scores[1]))}}}),define("score/shutdown",[],function(){return function(){game.vars.scores=null}}),define("score/main",["score/preload","score/create","score/shutdown"],function(e,t,n){return{preload:e,create:t,shutdown:n}}),define("tools/Level",[],function(){return function(e,t,n,r){this.level=0,this.precision=Math.pow(10,t),this.default=e*this.precision,this.min=n*this.precision,this.max=r*this.precision,this.add=function(e,t){this.change(e,t)},this.sub=function(e,t){this.change(-e,-t)},this.change=function(e,t){this.level+=e*this.precision+t,this.limit(),this.save()},this.floor=function(){return Math.floor(this.level/this.precision)},this.limit=function(){this.level<this.min?this.level=this.min:this.level>this.max&&(this.level=this.max)},this.load=function(){var e=parseInt(window.localStorage.getItem("So7S_level"));isNaN(e)?this.level=this.default:(this.level=e,this.limit())},this.save=function(){window.localStorage.setItem("So7S_level",this.level)},this.load()}}),define("tools/handleInput",[],function(){return{turn:function(e,t){if(game.vars.multiplayer){var n,r=t<window.innerHeight/2;e<window.innerWidth/2?n=0:(n=1,r=!r),game.vars.snakes[n].turn(r?"left":"right")}else game.vars.snakes[0].turn(e<window.innerWidth/2?"left":"right")},click:function(){switch(game.state.getCurrentState().key){case"Countdown":game.state.start("Game");break;case"Game":game.state.start("Score")}},keys:function(e){try{switch(e){case 37:game.vars.snakes[0].nextDir("l");break;case 38:game.vars.snakes[0].nextDir("t");break;case 39:game.vars.snakes[0].nextDir("r");break;case 40:game.vars.snakes[0].nextDir("b");break;case 65:game.vars.snakes[1].nextDir("l");break;case 87:game.vars.snakes[1].nextDir("t");break;case 68:game.vars.snakes[1].nextDir("r");break;case 83:game.vars.snakes[1].nextDir("b");break;case 13:case 27:case 32:this.click()}}catch(t){}}}}),define("tools/createEventListeners",["tools/handleInput"],function(e){return function(){document.body.addEventListener("touchstart",function(t){e[game.vars.clickAction](t.targetTouches[0].pageX,t.targetTouches[0].pageY)},!1),document.body.addEventListener("mousedown",function(t){e[game.vars.clickAction](t.pageX,t.pageY)},!1),document.addEventListener("keydown",function(t){e.keys(t.keyCode)})}}),requirejs(["init/main","menuMain/main","menuPlay/main","highScores/main","menuSettings/main","help/main","countdown/main","game/main","score/main","tools/Level","tools/createEventListeners","tools/storage"],function(e,t,n,r,i,s,o,u,a,f,l,c){window.game=new Phaser.Game(1200,720,Phaser.AUTO),window.game.vars={gameType:"classic",walledMap:!0,holesInMap:!0,enemy:!1,multiplayer:!0,playersAlive:0,food:null,snakes:[],enemies:[],scores:[],segments:[],LEDCount:0,rows:2,cols:6,quality:160,clickAction:"click",level:new f(1,1,1),speed:40,map:null,update:0,countDown:0,font:{name:"Arial",size:12,fill:"#DDDDDD",get:function(){return this.size+"px "+this.name},menu:function(){return"24px "+this.name},footer:function(){return"16px "+this.name}}},l(),window.game.state.add("Init",e),window.game.state.add("MenuMain",t),window.game.state.add("MenuPlay",n),window.game.state.add("HighScores",r),window.game.state.add("MenuSettings",i),window.game.state.add("Help",s),window.game.state.add("Countdown",o),window.game.state.add("Game",u),window.game.state.add("Score",a),c.load("help","help"),window.game.state.start("Init")}),define("main",function(){});